#!/bin/bash
# vim: set tw=95:

# Highlight
H="#FF$(getXresColor color7)"
# Urgent
U="#FF$(getXresColor color15)"
# Free
F="#FF$(getXresColor color8)"

while read -r line; do
    case ${line} in
        C*) #clock output
            clock="${line#?}"
            ;;
        S*) #system information
            sys_info="${line#?}"
            ;;
        W*) #bspwm internal state
            wm_infos=""
            IFS=":"
            set -- ${line#?}
            while [ $# -gt 0 ]; do
                item=${1}
                name=${item#?}
                case $item in
                    [OFU]*) wm_infos+="%{F${H}}%{U${H}}%{+o} \uE190 %{-o}%{U-}%{F-}" ;;
                    u*) wm_infos+="%{F${U}} \uE190 %{F-}" ;;
                    o*) wm_infos+="%{F${H}} \uE190 %{F-}" ;;
                    f*) wm_infos+="%{F${F}} \uE190 %{F-}" ;;
                esac
                shift
            done
            ;;
        esac

    printf "%b\n" "%{l}${clock} %{c}${wm_infos} %{r}${sys_info}"
done
