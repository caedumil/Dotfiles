#!/bin/bash
# vim: set tw=95:

SEP="#FF$(getXresColor color3)"
ULN="#FF$(getXresColor color8)"

while read -r line; do
    case ${line} in
        C*) #clock output
            clock="${line#?}"
            ;;
        S*) #system information
            sys_info="${line#?}"
            ;;
        W*) #bspwm internal state
            wm_infos=""
            IFS=":"
            set -- ${line#?}
            while [ $# -gt 0 ]; do
                item=${1}
                name=${item#?}
                case $item in
                    [OFU]*) wm_infos+="%{R}%{U${ULN}}%{+u}%{+o} ${name} %{-o}%{-u}%{U-}%{R}" ;;
                    u*) wm_infos+="%{R}%{U${ULN}}%{+o}% ${name} %{-o}%{U-}%{R}" ;;
                    o*) wm_infos+="%{R} ${name} %{R}" ;;
                    f*) ;;
                esac
                shift
            done
            ;;
        esac
    printf "%b %b %b\n" \
        "%{l}${clock}" \
        "%{c}%{F${SEP}}::%{F-}  ${wm_infos}  %{F${SEP}}::%{F-}" \
        "%{r}${sys_info}"
done
