#!/bin/bash

set -e

PANEL_FIFO="/tmp/bspwm.fifo"
DIR="${HOME}/.config/bspwm/bin"

FG="#FF$(getXresColor foreground)"
BG="#FF$(getXresColor background)"

if [[ $(pgrep -cx panel) -gt 1 ]]; then
    printf "%s\n" "The panel is already running." >&2
    exit 1
fi

trap "trap - TERM; kill 0" INT TERM QUIT EXIT

[[ -e ${PANEL_FIFO} ]] && rm ${PANEL_FIFO}
mkfifo ${PANEL_FIFO}

bspc config -m 0 top_padding 20

conky -c ${DIR}/conkyrc > ${PANEL_FIFO} &
bspc subscribe report > ${PANEL_FIFO} &

${DIR}/workspace < ${PANEL_FIFO} \
    | lemonbar -g "1280x20++" -u 3 -F "${FG}" -B "${BG}" \
        -f "-*-siji-medium-*-normal-*-*-*-*-*-c-*-*-*"\
        -f "-*-lime-medium-*-normal-*-*-*-*-*-*-*-*-*"

wait
